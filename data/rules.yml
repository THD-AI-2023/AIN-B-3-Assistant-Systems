# yaml-language-server: $schema=https://raw.githubusercontent.com/RasaHQ/rasa/refs/heads/main/rasa/shared/utils/schemas/stories.yml
version: "3.1"

rules:
  # ------------------------------------------------
  # Overwrite or Cancel Overwrite (only if risk_level is not set)
  # ------------------------------------------------
  - rule: Overwrite existing data
    condition:
      - slot_was_set:
          - pending_update: true
      - slot_was_set:
          - risk_level: null
    steps:
      - intent: affirm
      - action: action_confirm_overwrite

  - rule: Cancel overwrite
    condition:
      - slot_was_set:
          - pending_update: true
      - slot_was_set:
          - risk_level: null
    steps:
      - intent: deny
      - action: action_cancel_overwrite

  # ------------------------------------------------
  # Provide stroke risk reduction advice (only if risk_level=high)
  # ------------------------------------------------
  - rule: Provide stroke risk reduction advice
    condition:
      - slot_was_set:
          - risk_level: high
      - slot_was_set:
          - pending_update: false
    steps:
      - intent: affirm
      - action: action_provide_stroke_risk_reduction_advice

  # ------------------------------------------------
  # Handle denial of advice (only if risk_level=high)
  # ------------------------------------------------
  - rule: Handle denial of advice
    condition:
      - slot_was_set:
          - risk_level: high
      - slot_was_set:
          - pending_update: false
    steps:
      - intent: deny
      - action: utter_goodbye

  # ------------------------------------------------
  # Additional rules (fallback, chitchat, name introduction, etc.)
  # ------------------------------------------------
  - rule: Introduction of name
    steps:
      - intent: introduce_name
      - action: action_save_name
      - action: utter_greet_with_name

  - rule: Fallback rule
    steps:
      - intent: nlu_fallback
      - action: action_default_fallback

  - rule: Handle chitchat ask name
    steps:
      - intent: chitchat_ask_name
      - action: utter_chitchat_ask_name

  - rule: Handle chitchat tell joke
    steps:
      - intent: chitchat_tell_joke
      - action: utter_chitchat_tell_joke

  - rule: Handle chitchat favorite color
    steps:
      - intent: chitchat_favorite_color
      - action: utter_chitchat_favorite_color

  - rule: Handle chitchat weather
    steps:
      - intent: chitchat_weather
      - action: utter_chitchat_weather
